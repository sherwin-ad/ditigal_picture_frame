<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Picture Frame</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <!-- Optional: Add Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Roboto', sans-serif; }
    </style>
</head>
<body>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div id="message-area" class="flash-message">
        {% for message in messages %}
          <span>{{ message }}</span>
        {% endfor %}
        </div>
        <script>
            setTimeout(function() {
                var msg = document.getElementById('message-area');
                if(msg) {
                    msg.style.opacity = '0';
                    setTimeout(() => msg.remove(), 500);
                }
            }, 4000);
        </script>
      {% endif %}
    {% endwith %}

    <div id="slideshow-container">
        <!-- Images will be injected here via JS or rendered server-side -->
        {% if images %}
            {% for image in images %}
                <img src="{{ url_for('static', filename='photos/' + image) }}" class="slide {% if loop.first %}active{% endif %}" alt="Photo">
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <div class="empty-icon">üñºÔ∏è</div>
                <h1>No photos found</h1>
                <p>Upload some photos using the controls below (hover to see).</p>
            </div>
        {% endif %}
    </div>

    <!-- Controls Overlay (Visible on Hover) -->
    <div id="controls" {% if mode == 'display' %}style="display: none !important;"{% endif %}>
        
        <div class="control-section">
            <span class="control-label">Upload Photos</span>
            <form action="/upload" method="post" enctype="multipart/form-data">
                <label for="file-upload" class="custom-file-upload">
                    <span>Click to Select Files</span>
                </label>
                <input id="file-upload" class="file-input" type="file" name="files[]" multiple accept="image/*" onchange="this.form.submit()" style="display: none;">
            </form>
            <div style="font-size: 12px; text-align: right; color: var(--text-secondary);">
                {{ images|length }} Photos
            </div>
        </div>

        <div class="control-section">
            <span class="control-label">Local Display (Feh)</span>
            <div class="control-buttons">
                <a href="/control/feh/start" class="btn btn-small btn-primary">Start</a>
                <a href="/control/feh/stop" class="btn btn-small btn-danger">Stop</a>
                <a href="/control/feh/restart" class="btn btn-small">Restart</a>
                <a href="/view_local" target="_blank" class="btn btn-small" style="background-color: #2196F3; color: white;">View</a>
            </div>
        </div>

        <div class="control-section" style="border-bottom: none;">
            <span class="control-label">Navigation</span>
             <div class="control-buttons" style="justify-content: space-between;">
                 <a href="/gallery" class="btn btn-small">View Gallery</a>
                 <a href="/logout" class="btn btn-small btn-danger">Logout</a>
             </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const slides = document.querySelectorAll('.slide');
            let currentSlide = 0;
            const slideInterval = 5000; // 5 seconds per slide

            if (slides.length > 1) {
                setInterval(nextSlide, slideInterval);
            }

            function nextSlide() {
                // Remove 'active' class from current slide
                slides[currentSlide].classList.remove('active');
                
                // Calculate next slide index
                currentSlide = (currentSlide + 1) % slides.length;
                
                // Add 'active' class to next slide
                slides[currentSlide].classList.add('active');
            }
        });
    </script>
</body>
</html>